<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bomberman-DOM</title>
    <link href="../src/client/styles/map.css" rel="stylesheet">
    <link href="../src/client/styles/player.css" rel="stylesheet">
    <link href="../src/client/styles/bomb.css" rel="stylesheet">
    <link href="../src/client/styles/chat.css" rel="stylesheet">

</head>

<body>
    <!-- Bomberman Game Container -->
    <div class="game-timer"></div> <!-- Game Timer display -->

    <div id="root"></div>
    <div class="lives-display"></div>


    <!-- Chat Section -->
    <!-- <div id="chat-container" style="border-top: 1px solid #ccc; padding-top: 10px; margin-top: 20px;">
        <h2>Chat</h2>
        <div id="chat" style="height: 200px; overflow-y: auto; border: 1px solid #333; padding: 10px;"></div>
        <input type="text" id="message" placeholder="Type a message" style="width: 80%;">
        <button onclick="sendMessage()">Send</button>
    </div> -->

    <div id="chat-container" style="border-top: 1px solid #ccc; padding: 15px; background-color: #f9f9f9; border-radius: 8px; max-width: 600px; margin: 0 auto; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);">
        <h2 style="color: #333; font-family: Arial, sans-serif;">Chat</h2>
        <div id="chat" style="height: 300px; overflow-y: auto; background-color: #fff; border-radius: 8px; padding: 15px; margin-bottom: 15px; border: 1px solid #ddd; box-shadow: inset 0 1px 5px rgba(0, 0, 0, 0.05); color: #333;"> <!-- Add color here -->
            <!-- Chat messages will go here -->
        </div>
        <div style="display: flex;">
            <input type="text" id="message" placeholder="Type a message" style="flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 4px; box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1); margin-right: 10px;">
            <button onclick="sendMessage()" style="padding: 10px 20px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; transition: background-color 0.3s;">Send</button>
        </div>
    </div>
    
    

    <!-- Footer -->
    <footer class="info">
        <p>Created by
            <a href="https://github.com/RupertCheetham" target="_blank" rel="noopener noreferrer">Rupert</a>,
            <a href="https://github.com/m-fenton" target="_blank" rel="noopener noreferrer">Martin</a>, and
            <a href="https://github.com/kn1ko1/" target="_blank" rel="noopener noreferrer">Knikoi</a>
        </p>
    </footer>

    <!-- Game Logic Script -->
    <script src="../src/index.js"></script> <!-- Adjusted path -->

    <!-- WebSocket Chat Logic -->
    <!-- <script>
        const ws = new WebSocket("ws://localhost:8080/ws");

        // Receive message from WebSocket and display it in chat
        ws.onmessage = function(event) {
            const chat = document.getElementById("chat");
            const message = document.createElement("p");
            message.innerText = event.data;
            chat.appendChild(message);
            chat.scrollTop = chat.scrollHeight; // Auto-scroll to the bottom
        };

        // Send message via WebSocket
        function sendMessage() {
            const input = document.getElementById("message");
            const message = input.value.trim();

            if (message !== "") {
                ws.send(message);
                input.value = ''; // Clear input field
            }
        }
    </script> -->

    <!-- <script>
        const ws = new WebSocket("ws://localhost:8080/ws");

    
        // Function to display messages in chat
        function displayMessage(messageText, messageType) {
            const chat = document.getElementById("chat");
            const message = document.createElement("div");
            message.classList.add("message", messageType); // Use messageType for styling
    
            const messageContent = document.createElement("p");
            messageContent.innerText = messageText;
    
            message.appendChild(messageContent);
            chat.appendChild(message);
            chat.scrollTop = chat.scrollHeight; // Auto-scroll to the bottom
        }
    
        // Receive message from WebSocket and display it in chat as "received"
        ws.onmessage = function(event) {
            displayMessage(event.data, "received");
        };
    
        // Send message via WebSocket
        function sendMessage() {
            const input = document.getElementById("message");
            const message = input.value.trim();
    
            if (message !== "") {
                ws.send(message); // Send the message to the server
                displayMessage(message, "sent"); // Display it locally as "sent"
                input.value = ''; // Clear input field
            }
        }
    </script> -->

    <script>
        const ws = new WebSocket("ws://localhost:8080/ws");
        let currentPlayerId; // Declare without initializing
    
        // Function to display messages in chat
function displayMessage(messageData, messageType) {

     // Ensure messageData.text is a valid string
     const messageText = messageData.text || ''; // Default to an empty string if undefined


   // Prevent displaying empty messages
    if (!messageText || messageText.trim() === "") {
        console.warn("Attempted to display an empty message.");
        return; // Exit the function if the message is empty
    }


            const chat = document.getElementById("chat");
            const message = document.createElement("div");
            message.classList.add("message", messageType); // Use messageType for styling
    
            const messageContent = document.createElement("p");
            messageContent.innerText = messageText;
    
            message.appendChild(messageContent);
            chat.appendChild(message);
            chat.scrollTop = chat.scrollHeight; // Auto-scroll to the bottom
        }
    
    // Receive message from WebSocket and display it in chatws.onmessage = function(event) {
    ws.onmessage = function(event) {
    const messageData = JSON.parse(event.data);  // Expecting { "playerId": 1, "text": "Hello" }
    console.log("Message received:", messageData); // Log the incoming message

    // Skip processing if the message text is empty
    if (!messageData.text || messageData.text.trim() === "") {
        console.warn("Received message with empty text:", messageData);
        return; // Exit the function early
    }

    // Check if the message has a valid player ID
    if (messageData.playerId !== undefined) {
        currentPlayerId = messageData.playerId; // Set the player ID
        console.log("Player ID assigned:", currentPlayerId);
    }

    // Determine message type and display the message
    let messageType = messageData.playerId === currentPlayerId ? "sent" : "received";
    displayMessage(messageData.text, messageType);
};

        // Send message via WebSocket
 function sendMessage() {
            const input = document.getElementById("message");
            const messageText = input.value.trim();

            // Check if currentPlayerId is defined
    if (currentPlayerId === undefined) {
        console.warn("Cannot send message: currentPlayerId is undefined.");
        return; // Prevent sending the message
    }
    
         // Construct the message data object
    const messageData = {
        playerId: currentPlayerId,
        text: messageText
    };

    // Check if messageData is a valid JSON object before sending
    if (!messageData.text || messageData.text.trim() === "") {
        console.warn("Cannot send empty message.");
        return; // Prevent sending invalid messages
    }
    
                console.log("Sending message:", messageData);
                ws.send(JSON.stringify(messageData)); // Send the message as a JSON object

                // Only display the message as "sent" locally
                displayMessage(message, "sent"); // Display it locally as "sent"
                input.value = ''; // Clear input field
            }
        
    </script>
    
    

</body>

</html>
